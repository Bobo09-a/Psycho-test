<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>PSYCHOTEST by MARTIAL H</title>
<meta name="theme-color" content="#0b102a">
<style>
:root{
  --bg1:#050612; --bg2:#090b1e; --panel:#0d1027; --panel2:#12163a; --txt:#e6f7ff; --muted:#9fe3ff;
  --cyan:#00e5ff; --magenta:#b967ff; --green:#00ffa3; --yellow:#f9ff4d; --red:#ff4d6d; --line:#1b2154;
  --glow-cyan: 0 0 14px rgba(0,229,255,.45), 0 0 30px rgba(0,229,255,.25);
  --glow-mag: 0 0 14px rgba(185,103,255,.45), 0 0 30px rgba(185,103,255,.25);
  --glow-green: 0 0 14px rgba(0,255,163,.45), 0 0 30px rgba(0,255,163,.25);
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0; color:var(--txt); font-family:system-ui,-apple-system,Poppins,Inter,Segoe UI,Roboto,Arial,sans-serif;
  background:
    radial-gradient(1200px 800px at 70% -10%, #15205a 0, transparent 60%),
    radial-gradient(900px 600px at 0% 110%, #3a105a 0, transparent 60%),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  display:flex; align-items:center; justify-content:center; overflow:hidden;
}
.app{
  width:min(520px,100vw);
  height:100dvh; /* plein √©cran mobile r√©el */
  border:1px solid var(--line); border-radius:16px;
  background:linear-gradient(180deg,rgba(15,18,45,.92),rgba(5,7,20,.92));
  box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.03);
  position:relative; overflow:hidden;
  padding-bottom:calc(env(safe-area-inset-bottom));
  padding-top:calc(env(safe-area-inset-top));
}
header{position:absolute; left:10px; right:10px; top:10px; z-index:5}
.hud{display:flex; gap:6px; justify-content:space-between; flex-wrap:wrap}
.chip{padding:.35rem .55rem; border:1px solid var(--line); border-radius:999px; background:linear-gradient(180deg,rgba(18,22,58,.85),rgba(10,12,34,.85)); box-shadow:var(--glow-cyan); font-variant-numeric:tabular-nums; font-size:.95rem}
main{
  position:absolute;
  left:10px; right:10px;
  top:58px; bottom:68px; /* laisse toujours voir header + footer */
  overflow:auto; -webkit-overflow-scrolling:touch;
}
.card{width:100%; max-width:460px; margin:0 auto; background:linear-gradient(180deg,rgba(22,26,72,.96),rgba(12,14,38,.96)); border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow:0 14px 40px rgba(0,0,0,.25)}
h1{margin:.2rem 0 .4rem; font-size:20px; text-align:center; text-shadow:var(--glow-mag)}
h2{margin:.2rem 0 .4rem; font-size:19px; text-align:center}
p{margin:.2rem 0}
.muted{color:var(--muted); text-align:center}
.btn{appearance:none; border:1px solid var(--line); background:linear-gradient(180deg,rgba(25,31,84,.9),rgba(16,18,48,.9)); color:var(--txt); border-radius:12px; padding:.8rem .9rem; width:100%; font-weight:800; letter-spacing:.02em; box-shadow:inset 0 0 0 1px rgba(255,255,255,.05)}
.btn.primary{background:linear-gradient(135deg,#00e5ff,#7aa2ff); color:#06122a; border-color:transparent; box-shadow:0 10px 30px rgba(0,229,255,.35)}
.btn.warn{background:linear-gradient(180deg,#2b0f24,#190916); border-color:#61203f}
.row{display:flex; gap:8px; flex-wrap:wrap}
.grid{display:grid; gap:8px}
.gridLevels{display:grid; grid-template-columns:1fr 1fr; gap:8px}
.center{text-align:center}
.input{width:100%; padding:.9rem; border-radius:12px; border:1px solid #2a3688; background:linear-gradient(180deg,#070a1b,#0b0f26); color:var(--txt); font-weight:800; text-align:center; font-size:19px; box-shadow:inset var(--glow-cyan)}
.options{display:grid; grid-template-columns: 1fr 1fr; gap:8px}
.tag{display:inline-flex; gap:8px; align-items:center; padding:.3rem .5rem; border:1px solid var(--line); border-radius:999px; background:rgba(255,255,255,.04); color:var(--muted); font-size:.9rem}
.ok{color:var(--green); text-align:center; margin-top:.3rem}
.ko{color:var(--red); text-align:center; margin-top:.3rem}
footer{
  position:absolute; left:10px; right:10px; bottom:10px;
  display:flex; gap:8px; justify-content:space-between;
  padding-bottom:calc(env(safe-area-inset-bottom));
}
.ghost{background:transparent; box-shadow:var(--glow-cyan) inset}
.hidden{display:none!important}
.small{font-size:.9rem}

/* victory */
.victory{display:grid; place-items:center; gap:10px; padding:14px; text-align:center}
.victory h1{font-size:30px; letter-spacing:.08em; color:#bfefff; text-shadow:0 0 14px rgba(0,229,255,.6), 0 0 34px rgba(185,103,255,.45); animation:pulse 1.8s infinite ease-in-out}
@keyframes pulse{0%{transform:scale(1)} 50%{transform:scale(1.03)} 100%{transform:scale(1)}}
</style>
</head>
<body>
<div class="app" role="application" aria-label="PSYCHOTEST by MARTIAL H">
  <header>
    <div class="hud">
      <div class="chip">üéØ <b id="level">‚Äî</b></div>
      <div class="chip">‚≠ê <b id="score">0</b></div>
      <div class="chip">üß© <b id="progress">0/0</b></div>
    </div>
  </header>

  <main>
    <!-- Home -->
    <section id="screen-home" class="card">
      <h1>PSYCHOTEST<br><span style="font-size:.95em">by <span style="background:linear-gradient(135deg,#00e5ff,#b967ff);-webkit-background-clip:text;background-clip:text;color:transparent">MARTIAL H</span></span></h1>
      <p class="muted">Sans minuteur ‚Ä¢ +10 points par bonne r√©ponse ‚Ä¢ Mobile only</p>
      <div class="grid" style="margin-top:8px">
        <button class="btn primary" id="btnQuickStart">‚ñ∂Ô∏è D√©marrer (Niv. 1)</button>
        <button class="btn" id="btnContinue" disabled>‚è© Continuer</button>
      </div>
      <div class="grid" style="margin-top:8px">
        <div class="card" style="padding:10px">
          <div class="center small" style="margin-bottom:6px"><span class="tag">Choisir un niveau librement</span></div>
          <div class="gridLevels" id="levelsGrid"></div>
          <div class="grid" style="margin-top:8px">
            <button class="btn warn" id="btnBenin">üáßüáØ Niveau BENIN (50 tests)</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Play -->
    <section id="screen-play" class="card hidden">
      <div class="center"><div id="qType" class="tag">‚Äî</div></div>
      <h2 id="question">Question</h2>
      <div id="qArea" style="margin-top:6px"></div>
      <div id="feedback" class="muted" aria-live="polite" style="min-height:1.2em; margin-top:6px"></div>
      <div class="grid" style="margin-top:8px">
        <div class="row">
          <button id="btnValidate" class="btn">Valider</button>
          <button id="btnSkip" class="btn ghost">Passer</button>
        </div>
        <div class="row">
          <button id="btnShowAnswer" class="btn warn">Voir la r√©ponse</button>
          <button id="btnNext" class="btn hidden">Suivant</button>
        </div>
      </div>
    </section>

    <!-- End of level -->
    <section id="screen-end" class="card hidden">
      <h2 id="endTitle">Niveau termin√©</h2>
      <p id="endDesc" class="muted">‚Äî</p>
      <div id="answersList" class="hidden" style="text-align:left; margin:8px 0 0"></div>
      <div class="grid" style="margin-top:8px">
        <button id="btnShowAll" class="btn warn hidden">Voir toutes les r√©ponses du niveau</button>
        <button id="btnNextLevel" class="btn primary">Niveau suivant</button>
        <button id="btnRetry" class="btn">Recommencer le niveau</button>
        <button id="btnHome2" class="btn ghost">Accueil</button>
      </div>
    </section>

    <!-- Victory -->
    <section id="screen-victory" class="card hidden victory">
      <h1>VICTOIRE</h1>
      <p class="muted">Bravo, tu as compl√©t√© tous les tests !</p>
      <div class="grid" style="width:100%; max-width:320px; margin-top:8px">
        <button id="btnReplay" class="btn">Rejouer depuis le niveau 1</button>
        <button id="btnHome" class="btn ghost">Retour accueil</button>
      </div>
    </section>
  </main>

  <footer>
    <button id="btnRules" class="btn ghost" style="width:auto;padding:.6rem .8rem">‚ùì R√®gles</button>
    <button id="btnQuit" class="btn ghost" style="width:auto;padding:.6rem .8rem">Quitter</button>
  </footer>
</div>

<dialog id="rules" style="max-width:560px;width:92%;border:1px solid #26307a;border-radius:12px;background:linear-gradient(180deg,rgba(22,26,72,.98),rgba(12,14,38,.98));color:var(--txt)">
  <div style="padding:12px">
    <h3 style="margin:.2rem 0 .3rem;text-shadow:var(--glow-cyan)">R√®gles</h3>
    <ul class="small">
      <li>10 niveaux (libres) + <b>Niveau BENIN</b> (50 tests).</li>
      <li>Aucun minuteur. Score : <b>+10</b> par bonne r√©ponse.</li>
      <li>Tu peux <b>Passer</b> et <b>Voir la r√©ponse</b> √† tout moment.</li>
      <li>Progression et score sauvegard√©s (localStorage).</li>
      <li>Perte = Abandon/ Quitter (tu peux voir toutes les r√©ponses).</li>
    </ul>
    <div style="text-align:right"><button id="closeRules" class="btn" style="width:auto;padding:.5rem .8rem">OK</button></div>
  </div>
</dialog>

<script>
(()=>{'use strict';

/* ---------- Simple Sound (WebAudio) ---------- */
let actx;
function beep(type='ok'){
  try{
    actx = actx || new (window.AudioContext||window.webkitAudioContext)();
    const o = actx.createOscillator();
    const g = actx.createGain();
    o.connect(g); g.connect(actx.destination);
    const now = actx.currentTime;
    if(type==='ok'){ o.frequency.setValueAtTime(880, now); g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(0.18, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+0.15); }
    else if(type==='bad'){ o.frequency.setValueAtTime(220, now); g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(0.22, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+0.25); }
    else { o.frequency.setValueAtTime(660, now); g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(0.35, now+0.02); g.gain.exponentialRampToValueAtTime(0.0001, now+0.5); }
    o.start(); o.stop(now+0.5);
  }catch(e){}
}

/* ---------- State ---------- */
const levelEl = document.getElementById('level');
const scoreEl = document.getElementById('score');
const progEl  = document.getElementById('progress');

const scrHome = document.getElementById('screen-home');
const scrPlay = document.getElementById('screen-play');
const scrEnd  = document.getElementById('screen-end');
const scrVictory = document.getElementById('screen-victory');

const qTypeEl = document.getElementById('qType');
const qEl     = document.getElementById('question');
const qArea   = document.getElementById('qArea');
const feedback= document.getElementById('feedback');
const btnValidate = document.getElementById('btnValidate');
const btnNext = document.getElementById('btnNext');
const btnSkip = document.getElementById('btnSkip');
const btnShowAnswer = document.getElementById('btnShowAnswer');

let level = Number(localStorage.getItem('psy_level')||1);
let score = Number(localStorage.getItem('psy_score')||0);
let inLevel = false;
let currentIsBenin = false;
let beninMode = false;

let tasks = []; // {type, render(area), check() -> bool, solution, label}
let idx = 0;

scoreEl.textContent = score;
levelEl.textContent = level;
document.getElementById('btnContinue').disabled = level<=1;

/* ---------- Utilities ---------- */
const rint = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
const sample = (arr,n)=> { const c=arr.slice(); const out=[]; while(out.length<n){ out.push(c.splice(Math.floor(Math.random()*c.length),1)[0]||arr[Math.floor(Math.random()*arr.length)]); } return out; };
const shuffle = (arr)=> arr.map(v=> [Math.random(), v]).sort((a,b)=>a[0]-b[0]).map(p=>p[1]);

/* ---------- Task builders w/ solutions ---------- */
function makeInputTask(type, html, answer){
  let correct = answer;
  return {
    type, solution: String(correct), label: html.replace(/<[^>]+>/g,''),
    render(area){
      area.innerHTML = `<div class="center muted small" style="margin-bottom:6px">${html}</div>
        <input id="ans" class="input" inputmode="numeric" placeholder="R√©ponse">`;
      setTimeout(()=> document.getElementById('ans')?.focus(), 20);
    },
    check(){
      const v = document.getElementById('ans')?.value.trim();
      return String(v) === String(correct);
    }
  };
}
function makeTextTask(type, html, answer){
  return {
    type, solution: String(answer), label: html.replace(/<[^>]+>/g,''),
    render(area){
      area.innerHTML = `<div class="center muted" style="margin-bottom:6px">${html}</div>
        <input id="ans" class="input" inputmode="text" placeholder="R√©ponse (lettre)">`;
      setTimeout(()=> document.getElementById('ans')?.focus(), 20);
    },
    check(){
      const v = (document.getElementById('ans')?.value||'').trim().toUpperCase();
      return v === String(answer).toUpperCase();
    }
  };
}
function makeMCQ(type, html, options, correct){
  return {
    type, solution: String(correct), label: html.replace(/<[^>]+>/g,''),
    render(area){
      area.innerHTML = `<div class="center muted" style="margin-bottom:6px">${html}</div>
        <div class="options" id="opts"></div>
        <input id="ans" class="hidden">`;
      const box = area.querySelector('#opts');
      options.forEach(opt=>{
        const b = document.createElement('button');
        b.className='btn'; b.textContent=opt; b.type='button';
        b.onclick = ()=>{ document.querySelectorAll('#opts .btn').forEach(x=>x.classList.remove('primary')); b.classList.add('primary'); document.getElementById('ans').value = opt; };
        box.appendChild(b);
      });
    },
    check(){
      const v = (document.getElementById('ans')?.value||'').trim();
      return v === String(correct);
    }
  };
}

/* ---------- Global Bank (12 types, symbol tests -> MCQ) ---------- */
function genArithmetic(){
  const a=rint(5,60), b=rint(5,60), c=rint(2,9);
  const mode = rint(1,4);
  let text, ans;
  if(mode===1){ text = `(${a} + ${b}) √ó ${c}`; ans = (a+b)*c; }
  else if(mode===2){ text = `(${a*c} √∑ ${c}) + ${b}`; ans = a + b; }
  else if(mode===3){ text = `${a} √ó ${c} ‚àí ${b}`; ans = a*c - b; }
  else { text = `${a} + ${b} + ${c}`; ans = a+b+c; }
  return makeInputTask('Calcul mental', text, ans);
}
function genNumberSequence(){
  const start = rint(1,15), step = rint(1,9), len=5;
  const seq = Array.from({length:len}, (_,i)=> start + step*i);
  const ans = start + step*len;
  return makeInputTask('Suite num√©rique', seq.join(' , ') + ' , ?', ans);
}
function genLetterSequence(){
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  const start = rint(0,22), step = [1,2,3][rint(0,2)], len=4;
  const seq = Array.from({length:len}, (_,i)=> letters[(start + step*i)%26]);
  const ans = letters[(start + step*len)%26];
  return makeTextTask('Suite de lettres', seq.join(' , ') + ' , ?', ans);
}
function genAnalogy(){
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  const shift = [1,2,3,4][rint(0,3)];
  const A = letters[rint(0,25)], B = letters[(letters.indexOf(A)+shift)%26];
  const C = letters[rint(0,25)], D = letters[(letters.indexOf(C)+shift)%26];
  return makeTextTask('Analogie', `${A} est √† ${B} comme ${C} est √† ?`, D);
}
function genAttention(){
  const symbols = ['‚óÜ','‚óè','‚ñ†','‚ñ≤','‚òÖ','‚úö','‚ú¶'];
  const target = symbols[rint(0,symbols.length-1)];
  const total = rint(18,28);
  let arr = [], count = 0;
  for(let i=0;i<total;i++){
    const s = symbols[rint(0,symbols.length-1)];
    if(s===target) count++;
    arr.push(s);
  }
  const cloud = shuffle(arr).join(' ');
  // MCQ pour √©viter la saisie de symboles
  const options = [count, count+1, Math.max(0,count-1), count+2].map(String);
  return makeMCQ('Attention', `Combien de "${target}" ?<br><div class="card" style="text-align:center;font-size:22px;margin-top:6px">${cloud}</div>`, shuffle(options), String(count));
}
function genMemory(){
  const len=rint(6,8);
  const code = Array.from({length:len}, ()=> rint(0,9)).join('');
  return {
    type: 'M√©moire', solution: code, label: 'M√©morise un nombre',
    render(area){
      area.innerHTML = `<div class="center muted small">M√©morise ce nombre (2s)‚Ä¶</div>
        <div class="center" style="font-size:28px;margin:6px 0"><b id="mem">${code}</b></div>
        <input id="ans" class="input" inputmode="numeric" placeholder="Entre le nombre vu" disabled>`;
      setTimeout(()=>{
        const mem = area.querySelector('#mem'); if(mem){ mem.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'; }
        area.querySelector('#ans').disabled=false; area.querySelector('#ans').focus();
      }, 2000);
    },
    check(){ const v = (document.getElementById('ans')?.value||'').trim(); return v === code; }
  };
}
function genSpatial(){
  const turns = [1,2,3][rint(0,2)];
  const dir = ['Est','Sud','Ouest'][turns-1];
  const svg = `<svg width="120" height="120" viewBox="0 0 120 120">
    <rect x="0" y="0" width="120" height="120" rx="16" fill="#0b0f26" stroke="#2a3688"/>
    <g transform="translate(60,60)">
      <rect x="-12" y="-36" width="24" height="72" fill="#7aa2ff"/>
      <rect x="-12" y="12" width="48" height="24" fill="#7aa2ff"/>
    </g></svg>`;
  const opts = ['Nord','Est','Sud','Ouest'];
  return makeMCQ('Rotation mentale', `Tourne la forme de <b>${turns}√ó 90¬∞</b> <u>sens horaire</u>. Le pied pointe vers ?<br>${svg}`, opts, dir);
}
function genOddOneOut(){
  const base = rint(2,9);
  let arr = [base*2, base*3, base*4, base*5];
  const intrus = rint(11,29); arr[rint(0,3)] = intrus;
  const ans = arr.indexOf(intrus)+1;
  // MCQ positions
  const opts = shuffle([1,2,3,4].map(String));
  return makeMCQ('Intrus', `Quelle est la <b>position</b> de l'intrus ?<br><b>${arr.join('  ‚Ä¢  ')}</b>`, opts, String(ans));
}
function genCompare(){
  const base = 'AABBAABBABBAAB'.split('');
  const diffs = rint(2,4);
  let b2 = base.slice();
  for(let i=0;i<diffs;i++){ const j=rint(0,base.length-1); b2[j] = b2[j]==='A'?'B':'A'; }
  const options = shuffle([diffs, diffs+1, Math.max(0,diffs-1), diffs+2].map(String));
  return makeMCQ('Comparaison', `Combien de diff√©rences entre :<br><code>${base.join('')}</code><br><code>${b2.join('')}</code>`, options, String(diffs));
}
function genOrder(){
  let arr = Array.from({length:5}, ()=> rint(5,99));
  const sorted = arr.slice().sort((a,b)=>a-b);
  const ans = sorted[2];
  const options = shuffle([sorted[0], sorted[1], sorted[2], sorted[3]].map(String));
  return makeMCQ('Ordre', `Quel est le <b>3·µâ</b> plus petit ?<br><b>${arr.join('  ‚Ä¢  ')}</b>`, options, String(ans));
}
function genSymbols(){
  // unique symbole -> MCQ avec 4 choix (incluant symboles non clavier)
  const pool = ['‚óá','‚óÜ','‚óè','‚ñ†','‚ñ≤','‚òÖ','‚úö','‚ú¶','‚ú™','‚òº'];
  const grid = Array.from({length:10},()=> '‚óá');
  const odd = pool[rint(1,pool.length-1)];
  const pos = rint(0,grid.length-1); grid[pos]=odd;
  const options = shuffle([odd, '‚óè','‚ñ†','‚òÖ']).slice(0,4);
  return makeMCQ('D√©tail visuel', `Quel est le symbole <b>diff√©rent</b> ?<br><div class="center" style="font-size:26px;margin-top:6px">${grid.join(' ')}</div>`, options, odd);
}
function genLogicPattern(){
  const a = rint(2,9);
  const seq = [a, a+2, a+4, a+6];
  const ans = a+8;
  const options = shuffle([ans, ans+1, ans-1, ans+2].map(String));
  return makeMCQ('Logique', `Compl√®te la suite : ${seq.join(' , ')} , ?`, options, String(ans));
}
const globalBank = [genArithmetic, genNumberSequence, genLetterSequence, genAnalogy, genAttention, genMemory, genSpatial, genOddOneOut, genCompare, genOrder, genSymbols, genLogicPattern];

/* ---------- BENIN Bank (50 tests par niveau BENIN) ---------- */
function bn_fcfa_remise(){
  const prix=[2500,3500,5000,7500,10000][rint(0,4)];
  const remise=[5,10,15,20][rint(0,3)];
  const ans = Math.round(prix*(100-remise)/100);
  const opts = shuffle([ans, ans+200, Math.max(0,ans-200), ans+100].map(String));
  return makeMCQ('BENIN ‚Ä¢ FCFA', `Prix: <b>${prix} FCFA</b>, remise <b>${remise}%</b>. √Ä payer ?`, opts, String(ans));
}
function bn_rendu_marche(){
  const a1=[['ananas',350],['tomate',150],['≈ìuf',100],['oignon',200]][rint(0,3)];
  const a2=[['banane',100],['poivron',250],['piment',50],['pain',150]][rint(0,3)];
  const q1=rint(1,4), q2=rint(1,5);
  const total=q1*a1[1]+q2*a2[1];
  const pay√©=[1000,2000,5000][rint(0,2)];
  const rendu=pay√©-total;
  const opts = shuffle([rendu, rendu-50, rendu+50, rendu+100].map(String));
  return makeMCQ('BENIN ‚Ä¢ March√©', `${q1}√ó ${a1[0]} (${a1[1]}) + ${q2}√ó ${a2[0]} (${a2[1]}) pay√© <b>${pay√©} FCFA</b> ‚Üí rendu ?`, opts, String(rendu));
}
function bn_transport_temps(){
  const d1=[60,70,80,90,100][rint(0,4)]; // minutes
  const pause=[10,15,20][rint(0,2)];
  const d2=[30,40,50][rint(0,2)];
  const h = rint(5,18), m=rint(0,45);
  const depart = h*60+m;
  const arrivee = depart + d1 + pause + d2;
  const hh = Math.floor((arrivee% (24*60))/60), mm=(arrivee%60);
  const ans = String(hh).padStart(2,'0')+':'+String(mm).padStart(2,'0');
  const opts = shuffle([ans, '0'+((hh+1)%24)+':'+String(mm).padStart(2,'0'), String(hh).padStart(2,'0')+':'+String((mm+10)%60).padStart(2,'0'), String(hh).padStart(2,'0')+':'+String((mm+20)%60).padStart(2,'0')]);
  return makeMCQ('BENIN ‚Ä¢ Transport', `D√©part <b>${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}</b>. Trajet ${d1} min, pause ${pause} min, puis ${d2} min. Heure d'arriv√©e ?`, opts, ans);
}
function bn_conversion_litres(){
  const bid=rint(10,30); const nb=rint(2,5); const sup=rint(5,20);
  const ans = nb*bid + sup;
  const opts = shuffle([ans, ans+5, ans-5, ans+10].map(String));
  return makeMCQ('BENIN ‚Ä¢ Litres', `${nb} bidons de <b>${bid} L</b> + <b>${sup} L</b> ‚Üí total ?`, opts, String(ans));
}
function bn_regions(){
  // Paires connues : Abomey‚ÜíZou, Cotonou‚ÜíLittoral, Parakou‚ÜíBorgou, Porto-Novo‚ÜíOu√©m√©, Natitingou‚ÜíAtacora
  const pairs = [
    ['Abomey','Zou'], ['Cotonou','Littoral'], ['Parakou','Borgou'],
    ['Porto-Novo','Ou√©m√©'], ['Natitingou','Atacora']
  ];
  const pick = pairs[rint(0,pairs.length-1)];
  const cities = pairs.map(p=>p[0]);
  const deps = pairs.map(p=>p[1]);
  const other = deps.filter(d=> d!==pick[1]);
  const opts = shuffle([pick[1], other[0], other[1]||deps[0], other[2]||deps[1]]);
  return makeMCQ('BENIN ‚Ä¢ G√©o', `${pick[0]} est √† quel d√©partement ?`, opts, pick[1]);
}
function bn_ordre_age(){
  const names = ['Moussa','Akoss','S√®na','Rodrigue','Yann'];
  const ages = shuffle([12,14,16,18,20]);
  const arr = names.map((n,i)=> `${n}(${ages[i]} ans)`);
  const sorted = ages.slice().sort((a,b)=>a-b);
  const ans = sorted[2];
  const opts = shuffle([sorted[0],sorted[1],sorted[2],sorted[3]].map(String));
  return makeMCQ('BENIN ‚Ä¢ Ordre', `Qui est <b>3·µâ</b> par √¢ge croissant ?<br><small>${arr.join(' ‚Ä¢ ')}</small>`, opts, String(ans));
}
function bn_partage_cout(){
  const total=[3000,4500,6000,7500][rint(0,3)];
  const n=[3,4,5][rint(0,2)];
  const ans = Math.floor(total/n);
  const opts = shuffle([ans, ans+50, Math.max(0,ans-50), ans+100].map(String));
  return makeMCQ('BENIN ‚Ä¢ Partage', `Course zem √† <b>${total} FCFA</b> partag√©e entre <b>${n}</b> personnes. Part de chacun ?`, opts, String(ans));
}
function bn_suite_locale(){
  const base = rint(2,6), step = rint(2,4);
  const seq = [base, base+step, base+2*step, base+3*step];
  const ans = base+4*step;
  const opts = shuffle([ans, ans+step, ans-step, ans+2*step].map(String));
  return makeMCQ('BENIN ‚Ä¢ Suite', `Compl√®te : ${seq.join(' , ')} , ?`, opts, String(ans));
}
function bn_fcfa_pourboire(){
  const note=[1500,2000,3500,5000][rint(0,3)];
  const tip=[5,10,15][rint(0,2)];
  const ans = Math.round(note*tip/100);
  const opts = shuffle([ans, ans+50, Math.max(0,ans-50), ans+100].map(String));
  return makeMCQ('BENIN ‚Ä¢ Pourboire', `Note <b>${note} FCFA</b>, pourboire <b>${tip}%</b> = ?`, opts, String(ans));
}
function bn_rendu_simple(){
  const prix=[700,900,1200,1500][rint(0,3)];
  const pay√©=[1000,2000,5000][rint(0,2)];
  const ans = pay√© - prix;
  const opts = shuffle([ans, ans-50, ans+50, ans+100].map(String));
  return makeMCQ('BENIN ‚Ä¢ Rendu', `Prix: <b>${prix} FCFA</b>, pay√©: <b>${pay√©} FCFA</b>. Rendu ?`, opts, String(ans));
}
function bn_unites_kg(){
  const kg=[2,3,5,7][rint(0,3)], add=[1,2,3][rint(0,2)];
  const ans = kg+add;
  const opts = shuffle([ans, ans+1, ans-1, ans+2].map(String));
  return makeMCQ('BENIN ‚Ä¢ Kg', `Tu ach√®tes <b>${kg} kg</b> de ma√Øs et rajoutes <b>${add} kg</b>. Total ?`, opts, String(ans));
}
const beninBankFns = [bn_fcfa_remise,bn_rendu_marche,bn_transport_temps,bn_conversion_litres,bn_regions,bn_ordre_age,bn_partage_cout,bn_suite_locale,bn_fcfa_pourboire,bn_rendu_simple,bn_unites_kg];

/* ---------- Flow ---------- */
function show(id){
  [scrHome,scrPlay,scrEnd,scrVictory].forEach(s=> s.classList.toggle('hidden', s.id!==id));
}

function buildTasks(count, bankFns){
  const out = [];
  for(let i=0;i<count;i++){
    const g = bankFns[rint(0,bankFns.length-1)];
    out.push(g());
  }
  return out;
}

function startRegularLevel(lvl){
  beninMode = false;
  level = lvl;
  levelEl.textContent = level;
  inLevel = true;

  tasks = buildTasks(10, globalBank);
  idx = 0;

  scoreEl.textContent = score;
  progEl.textContent = `0/${tasks.length}`;
  btnNext.classList.add('hidden');
  btnValidate.classList.remove('hidden');
  renderTask();
  show('screen-play');
}

function startBeninLevel(){
  beninMode = true;
  levelEl.textContent = 'BENIN';
  inLevel = true;

  tasks = buildTasks(50, beninBankFns);
  idx = 0;

  scoreEl.textContent = score;
  progEl.textContent = `0/${tasks.length}`;
  btnNext.classList.add('hidden');
  btnValidate.classList.remove('hidden');
  renderTask();
  show('screen-play');
}

function renderTask(){
  feedback.textContent = '';
  feedback.className = 'muted';
  const task = tasks[idx];
  qTypeEl.textContent = task.type;
  qEl.textContent = `Question ${idx+1}`;
  qArea.innerHTML = '';
  task.render(qArea);
}

function validate(){
  const ok = tasks[idx].check();
  if(ok){
    beep('ok');
    feedback.textContent = 'Correct ‚úÖ (+10)';
    feedback.className = 'ok';
    score += 10;
    scoreEl.textContent = score;
    btnValidate.classList.add('hidden');
    btnNext.classList.remove('hidden');
  }else{
    beep('bad');
    feedback.textContent = 'Incorrect ‚ùå (tu peux Voir la r√©ponse ou Passer)';
    feedback.className = 'ko';
  }
}
function skip(){
  // passe sans p√©nalit√©
  btnNext.classList.add('hidden');
  btnValidate.classList.remove('hidden');
  next(true);
}
function showAnswer(){
  const sol = tasks[idx].solution ?? '‚Äî';
  feedback.innerHTML = `üí° R√©ponse : <b>${sol}</b>`;
  feedback.className = 'ok';
}

function next(fromSkip=false){
  if(idx < tasks.length-1){
    idx++;
    progEl.textContent = `${idx}/${tasks.length}`;
    renderTask();
  }else{
    inLevel = false;
    endLevel(true, 'Niveau termin√©.');
  }
  btnNext.classList.add('hidden');
  btnValidate.classList.remove('hidden');
}

/* ---------- End level ---------- */
function endLevel(success, msg){
  document.getElementById('endTitle').textContent = success ? (beninMode?'Niveau BENIN termin√©':`Niveau ${level} termin√©`) : (beninMode?'Niveau BENIN perdu':`Niveau ${level} perdu`);
  document.getElementById('endDesc').innerHTML = msg || '';
  show('screen-end');
  localStorage.setItem('psy_score', String(score));
  if(!beninMode && success){
    const nextLvl = (typeof level==='number'? level+1 : 1);
    localStorage.setItem('psy_level', String(nextLvl));
    document.getElementById('btnNextLevel').disabled = (nextLvl>10);
    document.getElementById('btnShowAll').classList.add('hidden');
    document.getElementById('answersList').classList.add('hidden');
    if(nextLvl>10){
      setTimeout(()=>{ show('screen-victory'); beep('victory'); }, 700);
    }
  }else{
    // soit perdu, soit niveau BENIN (pas de "niveau suivant" logique)
    document.getElementById('btnNextLevel').disabled = true;
    document.getElementById('btnShowAll').classList.remove('hidden');
    document.getElementById('answersList').classList.add('hidden');
  }
  document.getElementById('btnContinue').disabled = false;
}

/* ---------- Buttons ---------- */
// Accueil
document.getElementById('btnQuickStart').onclick = ()=>{ score=0; localStorage.setItem('psy_score','0'); localStorage.setItem('psy_level','1'); startRegularLevel(1); };
document.getElementById('btnContinue').onclick = ()=> {
  const lv = Number(localStorage.getItem('psy_level')||1);
  startRegularLevel(lv);
};
// Grille niveaux libres
(function buildLevelButtons(){
  const grid = document.getElementById('levelsGrid');
  for(let i=1;i<=10;i++){
    const b = document.createElement('button');
    b.className='btn'; b.textContent='Niveau '+i;
    b.onclick = ()=> startRegularLevel(i);
    grid.appendChild(b);
  }
})();
document.getElementById('btnBenin').onclick = ()=> startBeninLevel();

// En jeu
btnValidate.onclick = validate;
btnNext.onclick = ()=> next(false);
btnSkip.onclick = skip;
btnShowAnswer.onclick = showAnswer;

// Fin de niveau
document.getElementById('btnNextLevel').onclick = ()=> startRegularLevel((typeof level==='number'? level+1 : 1));
document.getElementById('btnRetry').onclick = ()=> beninMode ? startBeninLevel() : startRegularLevel(level);
document.getElementById('btnHome2').onclick = ()=> show('screen-home');

// Liste des r√©ponses
document.getElementById('btnShowAll').onclick = ()=>{
  const box = document.getElementById('answersList');
  box.innerHTML = '<h3 style="margin:.2rem 0 .3rem;text-align:center">R√©ponses du niveau</h3>';
  const ul = document.createElement('ul'); ul.style.listStyle='none'; ul.style.padding='0'; ul.style.display='grid'; ul.style.gap='6px';
  tasks.forEach((t,i)=>{
    const li = document.createElement('li');
    li.innerHTML = `<div class="card" style="padding:8px">
      <div class="small"><b>Q${i+1}</b> ‚Äî <span class="tag">${t.type}</span></div>
      <div class="small" style="opacity:.85;margin-top:4px">R√©ponse : <b>${t.solution ?? '‚Äî'}</b></div>
    </div>`;
    ul.appendChild(li);
  });
  box.appendChild(ul);
  box.classList.remove('hidden');
};

// R√®gles / Quitter
document.getElementById('btnRules').onclick = ()=> document.getElementById('rules').showModal();
document.getElementById('closeRules').onclick = ()=> document.getElementById('rules').close();
document.getElementById('btnQuit').onclick = ()=> { if(inLevel){ inLevel=false; endLevel(false, 'üëã Abandon'); } else { show('screen-home'); } };

// Init
progEl.textContent = '0/0';
levelEl.textContent = level;
scoreEl.textContent = score;

})();</script>
</body>
</html>
